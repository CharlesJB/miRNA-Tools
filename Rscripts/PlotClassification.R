# Utilitary functions
drawLines <- function() {
	lines(x=c(-75,-75), y=c(0,17), lty="solid", col="black")
	lines(x=c(-55,-55), y=c(0,9.5), lty="solid", col="black")
	lines(x=c(-55,-55), y=c(10,17), lty="solid", col="black")
}

drawText <- function(id) {
	mainText <- paste("Classification of the small RNA species - ", id, sep="")
	text(x=15, y=19, mainText, cex=1.2)
	title(xlab="Reads mapped (%)")
	text(x = -60, y=13.3, 'Genomic Repeats', srt=90, cex=1.1)
	text(x = -60, y=5, 'Functional ncRNAs', srt=90, cex=1.1)
	text(x = -80, y=8, 'RNA species', srt=90, cex=1.1)
}

drawPlot <- function(data, filetype, outputBasename) {
	if (type == "jpeg") {
		filename = paste("classification_", outputBasename, ".jpeg", sep="")
		jpeg(filename)
	}
	if (type == "tiff") {
		filename = paste("classification_", outputBasename, ".tiff", sep="")
		tiff(filename)
	}
	par(mai=c(1.5,3,1,1), xpd=NA)
	options(scipen = 50, digits = 10)
	barplot(data[,1], names=row.names(data), horiz=TRUE, las=2, xlim=c(0,100))
	drawText(outputBasename)
	drawLines()
	dev.off()
}

# Main
argv <- commandArgs(trailingOnly = T)

if (length(argv) == 3) {
	filename <- argv[1]
	data <- read.table(filename, row.names=1)
	outputBasename <- argv[2]
	type <- argv[3]

	drawPlot(data, type, outputBasename)
} else {
	cat("\nUsage:\n")
	cat("PlotClassificator.R <filename> <output>\n")
	cat("filename: name of the file generated by LengthDistributionAnalysis.sh\n")
	cat("output: suffix for the output filename and plot title.\n")
	cat("        output filename is: classification_<output>.jpeg/.tiff\n")
	cat("        title is: Classification of the small RNA species - <output>\n\n")
	cat("        type: type of file (jpeg, tiff, pdf, etc...)\n")
}
