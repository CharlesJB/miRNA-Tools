# To add with init
#DIR_SCRIPTS=...
#FILES_LENGTH+=...

DIR_SOURCE_FASTA_LENGTH=GenomeMapping/fasta
DIR_RESULTS_LENGTH=LengthDistributionAnalysis
DIR_FASTA_LENGTH=$(DIR_RESULTS_LENGTH)/Fasta
DIR_INTERMEDIATE_LENGTH=$(DIR_RESULTS_LENGTH)/Intermediate

TARGETS_FASTA_LENGTH=$(addprefix $(DIR_FASTA_LENGTH)/, $(FILES_LENGTH))
TARGETS_INTERMEDIATE_LENGTH=$(addprefix $(DIR_INTERMEDIATE_LENGTH)/, $(addsuffix _lengthDistribution.txt, $(basename $(FILES_LENGTH))))
TARGETS_LENGTH=$(addprefix $(DIR_RESULTS_LENGTH)/, $(addsuffix _lengthDistribution.tiff, $(basename $(FILES_LENGTH))))

.SECONDARY:
.PHONY: length-distribution
length-distribution: $(TARGETS_LENGTH)

$(DIR_RESULTS_LENGTH)/%.tiff: $(DIR_INTERMEDIATE_LENGTH)/%.txt $(DIR_SCRIPTS)/Rscripts/PlotLengthDistribution.R
	Rscript $(DIR_SCRIPTS)/Rscripts/PlotLengthDistribution.R $< $(basename $@)

$(DIR_INTERMEDIATE_LENGTH)/%_lengthDistribution.txt: $(DIR_FASTA_LENGTH)/%.fasta $(DIR_SCRIPTS)/Utility/LengthDistribution.py
	mkdir -p $(DIR_INTERMEDIATE_LENGTH)
	cat $< | $(DIR_SCRIPTS)/Utility/LengthDistribution.py 60 > $@

$(DIR_FASTA_LENGTH)/%.fasta: $(DIR_SOURCE_FASTA_LENGTH)/%.fasta
	mkdir -p $(DIR_FASTA_LENGTH)
	ln -fs ../../$< $@
